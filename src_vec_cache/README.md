This  optimization attempt does not work as it gets a segfault. I tried fixing it but I could not manage to get it working.